@model IEnumerable<JTimev2.Models.Timesheet>
@{
    ViewBag.Title = "TimesheetList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>TimesheetList</h2>
<table id="timesheet" class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Job Number</th>
            <th>Package</th>
            <th>Activity</th>
            <th>NCR</th>
            <th>Variation</th>
            <th>Monday</th>
            <th>Tuesday</th>
            <th>Wednesday</th>
            <th>Thursday</th>
            <th>Friday</th>
            <th>Saturday</th>
            <th>Sunday</th>
            <th>Total</th>
            <th>Billable</th>
            <th>Description</th>
            <th>Options</th>
        </tr>
       
    </thead>
    <tbody>

    </tbody>
</table> 

@section scripts
{
    <script>
        function restoreRow(oTable, nRow) {
            var aData = oTable.fnGetData(nRow);
            var jqTds = $('>td', nRow);

            for (var i = 0, iLen = jqTds.length ; i < iLen ; i++) {
                oTable.fnUpdate(aData[i], nRow, i, false);
            }

            oTable.fnDraw();
        }

        function editRow(oTable, nRow) {
            var aData = oTable.fnGetData(nRow);
            var jqTds = $('>td', nRow);
            jqTds[0].innerHTML = '<input type="text" value="' + aData[0] + '">';
            jqTds[1].innerHTML = '<input type="text" value="' + aData[1] + '">';
            jqTds[2].innerHTML = '<input type="text" value="' + aData[2] + '">';
            jqTds[3].innerHTML = '<input type="text" value="' + aData[3] + '">';
            jqTds[4].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[5].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[6].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[7].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[8].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[9].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[10].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[11].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[12].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[13].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[14].innerHTML = '<input type="text" value="' + aData[4] + '">';
            jqTds[15].innerHTML = '<a class="edit" href="">Save</a>';
        }

        function saveRow(oTable, nRow) {
            var jqInputs = $('input', nRow);
            oTable.fnUpdate(jqInputs[0].value, nRow, 0, false);
            oTable.fnUpdate(jqInputs[1].value, nRow, 1, false);
            oTable.fnUpdate(jqInputs[2].value, nRow, 2, false);
            oTable.fnUpdate(jqInputs[3].value, nRow, 3, false);
            oTable.fnUpdate(jqInputs[4].value, nRow, 4, false);
            oTable.fnUpdate(jqInputs[5].value, nRow, 5, false);
            oTable.fnUpdate(jqInputs[6].value, nRow, 6, false);
            oTable.fnUpdate(jqInputs[7].value, nRow, 7, false);
            oTable.fnUpdate(jqInputs[8].value, nRow, 8, false);
            oTable.fnUpdate(jqInputs[9].value, nRow, 9, false);
            oTable.fnUpdate(jqInputs[10].value, nRow, 10, false);
            oTable.fnUpdate(jqInputs[11].value, nRow, 11, false); 
            oTable.fnUpdate(jqInputs[12].value, nRow, 12, false);
            oTable.fnUpdate(jqInputs[13].value, nRow, 13, false);
            oTable.fnUpdate(jqInputs[14].value, nRow, 14, false);
            oTable.fnUpdate('<a class="edit" href="">Edit</a>', nRow, 15, false);
            oTable.fnDraw();
        }


        $(document).ready(function () {
            var oTable = $("#timesheet").DataTable({
                ajax: {
                    url: "/api/timesheets",
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "jobNumber"
                    },
                    {
                        data: "package"
                    },
                    {
                        data: "activity"
                    },
                    {
                        data: "ncr"
                    },
                    {
                        data: "variation"
                    },
                    {
                        data: "mondayTime"
                    },
                    {
                        data: "tuesdayTime"
                    },
                    {
                        data: "wednesdayTime"
                    },
                    {
                        data: "thursdayTime"
                    },
                    {
                        data: "fridayTime"
                    },
                    {
                        data: "saturdayTime"
                    },
                    {
                        data: "sundayTime"
                    },
                    {
                        data: "total"
                    },
                    {
                        data: "billable"
                    },
                    {
                        data: "description"
                    },
                    {
                        render: function (data, type) {
                            return '<a class="edit" href="">Edit</a> <a class="delete" href="">Delete</a>';
                        }
                    }
                    

                ]

            });
            var nEditing = null;

            $('#new').click(function (e) {
                e.preventDefault();

                var aiNew = oTable.fnAddData(['', '', '', '', '',
                    '<a class="edit" href="">Edit</a> <a class="delete" href="">Delete</a>']);
                var nRow = oTable.fnGetNodes(aiNew[0]);
                editRow(oTable, nRow);
                nEditing = nRow;
            });

            $('#timesheet a.delete').live('click', function (e) {
                e.preventDefault();

                var nRow = $(this).parents('tr')[0];
                oTable.fnDeleteRow(nRow);
            });

            $('#timesheet a.edit').live('click', function (e) {
                e.preventDefault();

                /* Get the row as a parent of the link that was clicked on */
                var nRow = $(this).parents('tr')[0];

                if (nEditing !== null && nEditing != nRow) {
                    /* Currently editing - but not this row - restore the old before continuing to edit mode */
                    restoreRow(oTable, nEditing);
                    editRow(oTable, nRow);
                    nEditing = nRow;
                }
                else if (nEditing == nRow && this.innerHTML == "Save") {
                    /* Editing this row and want to save it */
                    saveRow(oTable, nEditing);
                    nEditing = null;
                }
                else {
                    /* No edit in progress - let's start one */
                    editRow(oTable, nRow);
                    nEditing = nRow;
                }
            });
        });
    </script>
    
    }
